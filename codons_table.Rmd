---
title: "Relative tRNA concentrations data"
author: "Dmytro Strunin"
date: "3/24/2020"
output: pdf_document
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(kableExtra)
library(Biostrings)
```

## Input data

Data exported to .csv format for further analysis.

```{r}
codon_tab <- read_csv('./dat/ftb/codons_rel_freq.csv')

head(codon_tab) %>%
  kable(digits = 2, caption = 'Raw data (only first 6 rows are shown)') %>%
  kable_styling() 
```

## Data cleaning

- remove digits from `anticodon`/`codon` strings (those are still in the `probe` variable);
- split `anticodon` by `-` to separate it into *amino acid* (`aa`) and *codon/anticodon* variables;
- remove amino acid identifier from `codon` variable;
- work with `codon` variable, to make all alternative codons from records like `CGC/T/C/G`:
    - Extract first two letters from each codon string;
    - Extract the part from third letter up to the end;
        - Split it by `/` into three letters;
    - Combine first two letters and all the parts obtained in previous step one by one;
- unnest `codon` variable (it is a list right now);

```{r}
codon_tab <- codon_tab %>%
  mutate_at(vars(anticodon, codon), ~ gsub('-\\d+$', '', .)) %>%
  tidyr::separate(   
    col  = anticodon,
    into = c('aa', 'anticodon'),
    sep  = '-'
  ) %>%
  dplyr::mutate(codon = gsub('^\\w+-(.+)$', '\\1', codon)) %>%
  dplyr::mutate(
    codon   = purrr::map(
      codon,
      ~ paste0(
        substr(., 1, 2),
        unlist(strsplit(substr(., 3, nchar(.)), split = '/'))
      )
    )
  ) %>%
  tidyr::unnest(codon)

head(codon_tab) %>%
  kable(digits = 2, caption = 'Initial cleaning (only first 6 rows are shown)') %>%
  kable_styling() 
```

### Amino acids count

First we can check how many aminoacids are there:

```{r}
codon_tab %>%
  arrange(aa) %>%
  pull(aa) %>%
  table
```

It seems fine, at least from the first glance, since there are `r length(unique(codon_tab$aa))`amino acids out of usual 21, and it seems that all of them are there:

```{r}
missing_aa <- AMINO_ACID_CODE[!(AMINO_ACID_CODE %in% codon_tab$aa)]
```

Except abbreviation for special cases: `r missing_aa`, and with addition of *N-Formylmethionine*.

### Codons count

The problem seems to be in codons list. In the table below we can see the count of codons per each amino acid, for standard genetic code:

```{r}
aa_cdns <- data.frame(aa = AMINO_ACID_CODE[GENETIC_CODE], codon = names(GENETIC_CODE))

aa_cdns %>%
  na.omit() %>%            # remove stop codons
  pull(aa) %>%
  table()
  
```
And comparing it to our data:

```{r}
codon_tab %>%
  arrange(aa) %>%
  pull(aa) %>%
  table()
```

